<%- include('../partials/header') %>

<section>
    <div class="container mt-4">
        <div class="alert alert-primary text-center" role="alert">
            Welcome to the Admin Dashboard!
        </div>
       
         <br><h2 class="text-center">Admin Dashboard</h2> <br>
        <!-- Button trigger modal -->
         <div class="text-center mb-4">
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
            Create product
            </button>
        </div>


        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Create product</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Create product form -->
                    <form id="createProductForm" action="/admin/products" method="POST">
                        <div class="mb-3">
                            <label for="productName" class="form-label">Product Name</label>
                            <input type="text" class="form-control" id="name" name="name" placeholder="Enter product name">
                        </div>
                        <div class="mb-3">
                            <label for="productPrice" class="form-label">Product Price</label>
                            <input type="number" class="form-control" id="price" name="price" placeholder="Enter product price">
                        </div>
                        <div class="mb-3">
                            <label for="productDescription" class="form-label">Product Description</label>
                            <textarea class="form-control" id="description" name="description" rows="3" placeholder="Enter product description"></textarea>
                        </div>
                        
                        <select class="form-select mb-3" aria-label="Default select example" id="category" name="category">
                            <option selected>Select Category</option>
                            <option value="Food">Food</option>
                            <option value="Electronics">Electronics</option>
                            <option value="Clothing">Clothing</option>
                            <option value="Books">Books</option>
                            <option value="Home Appliances">Home Appliances</option>
                            <option value="Toys">Toys</option>
                        </select>
                        <div class="mb-3">
                            <label for="productStock" class="form-label">Product Stock</label>
                            <input type="number" class="form-control" id="stock" name="stock" placeholder="Enter product stock quantity">
                        </div>

                        <div class="mb-3">
                            <label for="productImage" class="form-label">Product Image</label>
                            <!-- <input type="text" class="form-control" id="image" name="image" placeholder="Enter product image URL"> -->
                            
                            <!-- image upload -->
                            <input type="file" class="form-control" id="imageUpload" name="imageUpload" accept="image/*">

                            <!-- small script to convert uploaded image to string(base64) -->
                            <script>
                                document.getElementById('imageUpload').addEventListener('change', function() {
                                    const file = this.files[0];
                                    const reader = new FileReader();
                                    reader.onloadend = function() {
                                        const base64String = reader.result.replace("data:", "").replace(/^.+,/, "");
                                        // Create a hidden input to store the base64 string
                                        let hiddenInput = document.getElementById('image');
                                        if (!hiddenInput) {
                                            hiddenInput = document.createElement('input');
                                            hiddenInput.type = 'hidden';
                                            hiddenInput.id = 'image';
                                            hiddenInput.name = 'image';
                                            document.querySelector('#createProductForm').appendChild(hiddenInput);
                                        }
                                        hiddenInput.value = base64String;
                                    }
                                    reader.readAsDataURL(file);
                                });
                            </script>

                        </div>

                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <input type="submit" class="btn btn-primary" value="Save changes">
                    </form>

                </div>
            </div>
        </div>
        </div>


    </div>
</section>

<section>
    <div class="container mt-4">
        <div class="alert alert-info text-center" role="alert">
            Here you can manage products.
        </div>
    </div>
    <div class="container mt-4">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Image</th>
                    <th scope="col">Name</th>
                    <th scope="col">Price</th>
                    <th scope="col">Category</th>
                    <th scope="col">Stock</th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody>
                <% products.forEach((product, index) => { %>
                    <tr>
                        <th scope="row"><%= index + 1 %></th>
                        <td><img src="data:image/png;base64,<%= product.image %>" alt="<%= product.name %>" class="img-fluid" style="max-width: 100px;"></td>
                        <td><%= product.name %></td>
                        <td>Rs <%= product.price %></td>
                        <td><%= product.category %></td>
                    <td><%= product.stock %></td>
                    <td>
                        <a class="btn btn-sm btn-warning" href='/admin/products/update/<%= product._id %>'>Edit</a>
                        <a class="btn btn-sm btn-danger deleteButton" href="/admin/products/delete/<%= product._id %>">Delete</a>
                        <!-- add prompt-->
                         <script>
                            document.querySelectorAll('.deleteButton').forEach(button => {
                                button.addEventListener('click', function(event) {
                                    if(!confirm('Are you sure you want to delete this product?')) {
                                        event.preventDefault();
                                    }
                                });
                            });
                        </script>
                    </td>
                </tr>
                <% }); %>
            </tbody>
        </table>
</section>



<%- include('../partials/footer') %>