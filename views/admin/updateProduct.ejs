<%- include('../partials/header') %>

<section>
    <div class="container mt-4">
        <div class="alert alert-primary text-center" role="alert">
            Welcome to the Product Management Page!
        </div>
       
         <br><h2 class="text-center">Update Product details</h2> <br>

        <form id="updateProductForm" action="/admin/products/update/<%= product._id %>" method="POST">
            <div class="mb-3 text-center">
                <img id="existingImage" src="data:image/png;base64,<%= product.image %>" alt="Existing Product Image" class="img-fluid" style="max-width: 200px; margin-bottom: 10px;">
            </div>
            <div class="mb-3">
                <label for="productName" class="form-label">Product Name</label>
                <input type="text" class="form-control" id="name" name="name" value="<%- product.name %>">
            </div>
            <div class="mb-3">
                <label for="productPrice" class="form-label">Product Price</label>
                <input type="number" class="form-control" id="price" name="price" value="<%- product.price %>">
            </div>
            <div class="mb-3">
                <label for="productDescription" class="form-label">Product Description</label>
                <textarea class="form-control" id="description" name="description" rows="3" placeholder="Enter product description"><%- product.description %></textarea>
            </div>
            
            <select class="form-select mb-3" aria-label="Default select example" id="category" name="category">
                <option value="Food">Food</option>
                <option value="Electronics">Electronics</option>
                <option value="Clothing">Clothing</option>
                <option value="Books">Books</option>
                <option value="Home Appliances">Home Appliances</option>
                <option value="Toys">Toys</option>
            </select>
            <script>
                // Set the selected category based on the product's current category
                document.getElementById('category').value = "<%- product.category %>";
            </script>

            <div class="mb-3">
                <label for="productStock" class="form-label">Product Stock</label>
                <input type="number" class="form-control" id="stock" name="stock" value="<%- product.stock %>">
            </div>

            <div class="mb-3">
                <label for="productImage" class="form-label">Product Image</label>
                <!-- <input type="text" class="form-control" id="image" name="image" placeholder="Enter product image URL"> -->
            
       
                <!-- image upload -->
                <input type="file" class="form-control" id="imageUpload" name="imageUpload" accept="image/*">

                <!-- small script to convert uploaded image to string(base64) -->
                <script>
                    document.getElementById('imageUpload').addEventListener('change', function() {
                        const file = this.files[0];
                        const reader = new FileReader();
                        reader.onloadend = function() {
                            const base64String = reader.result.replace("data:", "").replace(/^.+,/, "");
                            // Create a hidden input to store the base64 string
                            let hiddenInput = document.getElementById('image');
                            if (!hiddenInput) {
                                hiddenInput = document.createElement('input');
                                hiddenInput.type = 'hidden';
                                hiddenInput.id = 'image';
                                hiddenInput.name = 'image';
                                document.querySelector('#updateProductForm').appendChild(hiddenInput);
                            }
                            hiddenInput.value = base64String;
                        }
                        reader.readAsDataURL(file);

                        // Preview the uploaded image
                        const imgPreview = document.getElementById('existingImage');
                        imgPreview.src = URL.createObjectURL(file);
                        imgPreview.style.display = 'block';
                    });
                </script>

            </div>

            <button type="submit" class="btn btn-primary">Update Product</button>
        </form>


    </section>

<%- include('../partials/footer') %>